<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/3da1a747b2.js" crossorigin="anonymous"></script>
    <title>Weather Forecast</title>
    <style>
      .bg-RP {
          background-color:#007cae;     
         }
      .mt-4 {
        margin-top: 20rem ;
        }

      .ml-1 {
        margin-left: (1 * .25) ;
        }

      .px-2 {
        padding-left: (1 * .5) ;
        padding-right: (1 * .5) ;
        }
      .bg-yellow {
          background-color:yellow;
      }
      .bg-violet {
          background-color:violet;
      }

  </style>
</head>
<body>

<!--Navbar Start-->
<nav class="container-fluid bg-RP">
  <div class="navbar container mb-3 navbar-expand-lg navbar-dark bg-RP"> 
      <a class="navbar-brand" href="index.html">RIPortfolios</a>  
      <button 
          class="navbar-toggler" 
          type="button" 
          data-toggle="collapse" 
          data-target="#navbarSupportedContent" 
          aria-controls="navbarSupportedContent" 
          aria-expanded="false" 
          aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
      
          <form class="form-inline my-2 my-lg-0">
              <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
              <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
          </form>
      
          <ul class="navbar-nav ml-auto">
          <li class="nav-item">
          <a class="nav-link" href="#front-end">FrontEnd Projects <span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
          <a class="nav-link" href="#back-end">BackEnd Projects</a>
          </li>
          <li class="nav-item">
              <a class="nav-link" href="Login.html">Login</a>
          </li>
          <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" 
              href="#" 
              id="navbarDropdown" 
              role="button" 
              data-toggle="dropdown" 
              aria-haspopup="true" 
              aria-expanded="false">
              Lets Connect
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
              <a class="dropdown-item" href="ContactUs.html">Contact us</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="about.html">About</a>
          </div>
          </li>
      </ul>
      </div>
    </div>
  </nav> 
<!--Navbar end-->
<main id="planner" class="container mt-5">  
<!--Side left Navbar Start-->
    <div class="row">
        <nav  class="col-12 col-md-3 bg-light" id="time&date">      
            <!-- Start - clock on the side bar -->
            
            <p class="border border-light h-30 bg-light font-weight-bold ">Search for a city:</p>
            
            <div class="input-group mb-3">
                <input type="text" class="form-control inputcity" placeholder="City" aria-label="City name" aria-describedby="basic-addon2">
                <div class="input-group-append">
                  <button class="btn btn-outline-secondary search" type="button">Search</button>
                </div>
            </div>

            <div class="list-group">
                <a href="#" class="list-group-item list-group-item-action  active">
                  Cras justo odio
                </a>
                <a href="#" class="list-group-item list-group-item-action">Dapibus ac facilisis in</a>
                <a href="#" class="list-group-item list-group-item-action">Morbi leo risus</a>
                <a href="#" class="list-group-item list-group-item-action">Porta ac consectetur ac</a>
                <a href="#" class="list-group-item list-group-item-action disabled">Vestibulum at eros</a>
            </div>

            <div class="border border-secondary h-30 rounded text-center mt-4 clock"></div>
            <div class="border border-secondary h-30 rounded text-center date" id="date"></div>
            <div class="my-5" id="calendar-container">
                <div id="calendar-header">
                    <span id="calendar-month-year"></span>
                </div>
                    <div id="calendar-dates"></div>
                </div>
            <p class=""></p>
            <p class=""></p>
            <p class=""></p>
        </nav>
<!--Side left Navbar End-->


        <div class="col-12 col-md-9"> <!--Planner Header start-->
            <div class="jumbotron">
                <h1 class="display-2 cityname">city</h1>
                <hr class="my-4">
                <p class="temp">Temperature: <span class="tempno"></span</p>
                <p class="humidity">Humidity: <span class="humidityno"></span</p>
                <p class="Wind Speed">Wind Speed: <span class="windspeedno"></span</p>
                <p class="UV Index">UV Index: <span class="uvindexno"></span></p>
                <!-- <p class="lead">
                  <a class="btn btn-primary btn-lg" href="#" role="button">Learn more</a>
                </p> -->
              </div>
            </header> <!--Planner Header end-->

            
           <div class="row forecast justify-content-around">
            <!-- <div class="card bg-primary text-white" style="width: 9rem;">
                <img class="card-img-top" src="..." alt="Card image cap">
                <div class="card-body">
                  <h5 class="card-title">Date</h5>
                  <p class="temp">Temperature: <span class="fortempno">30</span</p>
                  <p class="humidty">humidty: <span class="forhumidityno">80%</span</p>
                
                </div>
              </div>
              <div class="card" style="width: 9rem;">
                <img class="card-img-top" src="..." alt="Card image cap">
                <div class="card-body">
                  <h5 class="card-title">Date</h5>
                  <p class="temp">Temperature: <span class="fortempno">30</span</p>
                  <p class="humidty">humidty: <span class="forhumidityno">80%</span</p>
                  
                </div>
              </div>
              <div class="card" style="width: 9rem;">
                <img class="card-img-top" src="..." alt="Card image cap">
                <div class="card-body">
                  <h5 class="card-title">Date</h5>
                  <p class="temp">Temperature: <span class="fortempno">30</span</p>
                  <p class="humidty">humidty: <span class="forhumidityno">80%</span</p>
                  
                </div>
              </div>
              <div class="card" style="width: 9rem;">
                <img class="card-img-top" src="..." alt="Card image cap">
                <div class="card-body">
                  <h5 class="card-title">Date</h5>
                  <p class="temp">Temperature: <span class="fortempno">30</span</p>
                  <p class="humidty">humidty: <span class="forhumidityno">80%</span</p>
                  
                </div>
              </div>
              <div class="card" style="width: 9rem;">
                <img class="card-img-top" src="..." alt="Card image cap">
                <div class="card-body">
                  <h5 class="card-title">Date</h5>
                  <p class="temp">Temperature: <span class="fortempno">30</span</p>
                  <p class="humidty">humidty: <span class="forhumidityno">80%</span</p>
                  
                </div>
              </div> -->
           </div> 
        </div>

        <!-- Event planner Main -->

            


       
        <script type="text/javascript">            
         var coordMatrix = [];  
        
        // end - clock on the side bar 
        
        window.onload = function(){
        //$(document).ready(function() { 
            var d = moment();
            var date = d.format("MMMM Do YYYY");
            var month_name = ['January','February','March','April','May','June','July','August','September','October','November','December'];
            var month = d.month();   //0-11
            var year = d.year(); //2020
            var first_date = month_name[month] + " " + 1 + " " + year;
            //September 1 2014
            var todayDate = d.format("ddd MMM DD YYYY");
            //console.log(todayDate);

            //Mon Sep 01 2014 ...
            var first_day = todayDate.substring(0, 3);    //Mon
            //console.log(first_day)
            var day_name = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
            var day_no = day_name.indexOf(first_day);   //gives the index of current day in the array 
            var days = d.daysInMonth();    //number of days in the current month i.e. 30
            var todayOfmonth = d.format("DD");
            var firstdayOfmonth = day_name.indexOf(d.startOf("month").format("ddd"))
            let dayOfmonth = null
            dayOfmonth = JSON.parse(localStorage.getItem("plannerDate"));
                if (dayOfmonth==null) {
                    dayOfmonth = todayOfmonth;
                }
            var calendar = get_calendar(firstdayOfmonth, days, todayOfmonth, dayOfmonth);
            let storedPlans = new Array(9).fill(null)
            let actionRegister = new Array(9).fill(null)
            console.log(days)
            let actionRegisterObj = new Array(days).fill(Array(9).fill(null))
            let storedPlansObj = new Array(days).fill(Array(9).fill(null))

            $('#calendar-month-year').text(month_name[month]+" "+year);
            $('#calendar-dates').append(calendar);
            $('.date').append(date);
            // Navbar End

            var queryURL;
            var weatherObj;
            var city;
            var temp;
            var humidity;
            var unindex;
            var windspeed;
            var cities = [];
            var weatherimagecode;
            

            $('.search').on('click', function(event) { 
                console.log("yes")
                event.preventDefault();
                var input = $(".inputcity").val().trim()
                console.log(input)
                cities.push(input)
                // Here we are building the URL we need to query the database
                //weatherQuery(input,cities,todayDate)
                weatherforecastQuery(input,cities,todayDate)

                
            })

                // get times from moment
                const now = moment().format('MMMM Do YYYY')
                let nowHour24 = moment().format('H');
                let nowHour12 = moment().format('h');
            };

            
            function updateTime() {
                const now = moment();
                const humanReadable = now.format("hh:mm:ssa");
                $('.clock').text(humanReadable);
            };
            setInterval(updateTime,1000);


            function weatherQuery(city,cities,todayDate) { 
            var APIKey = "a07df414557c7b11b6dc89a1457fd71b";
            var cityCoord = {};
            queryURL = "https://api.openweathermap.org/data/2.5/weather?q=" + city + "&units=imperial&appid=" + APIKey;
            $.ajax({
                url: queryURL,
                method: "GET"
                })
                // We store all of the retrieved data inside of an object called "response"
                .then(function(response) {

                    // Log the queryURL
                    console.log(queryURL);

                    // Log the resulting object
                    cities.push(response.name)
                    console.log(cityCoord)
                    coordMatrix = [response.coord.lat,response.coord.lon]
                    city = response.name
                    weatherimagecode = response.weather[0].icon
                    cityCoord[city] = coordMatrix;
                    var imglink = "http://openweathermap.org/img/wn/" + weatherimagecode + "@2x.png" 
                    var img = $("<img>");
                    img.attr("src",imglink)
                    console.log(img)
                    // Transfer content to HTML
                    $(".cityname").html(response.name + " (" + todayDate + ")");
                    $(".cityname").append(img)
                    $(".windspeedno").text(response.wind.speed);
                    $(".humidityno").text(response.main.humidity);
                    $(".tempno").text(response.main.temp);
                    //uvQuery(coordMatrix);
                });
            };

            function uvQuery(coord) { 
            var APIKey = "a07df414557c7b11b6dc89a1457fd71b";
            console.log(coord)
            queryURL = "https://api.openweathermap.org/data/2.5/uvi?lat=" + coord[0] + "&lon=" + coord[1] + "&appid=" + APIKey;
            $.ajax({
                url: queryURL,
                method: "GET"
                })
                // We store all of the retrieved data inside of an object called "response"
                .then(function(response) {
                    // Log the queryURL
                    console.log(queryURL);
                    // Log the resulting object
                    console.log(response);
                    // Transfer content to HTML
                    $(".uvindexno").text(response.value);
                    var uvindex = 8.23;
                    console.log(response.value < 3)
                    console.log(3 << response.value << 6)
                    console.log(6 < response.value < 8)
                    console.log(8 < response.value < 11)

                    if (response.value < 3) {
                        $(".uvindexno").removeClass("bg-warning bg-danger bg-success bg-violet bg-yellow")
                        $(".uvindexno").addClass("bg-success")
                    } else if ( 3 <= response.value && response.value < 6) {
                        $(".uvindexno").removeClass("bg-warning bg-danger bg-success bg-violet bg-yellow")
                        $(".uvindexno").addClass("bg-yellow")
                    } else if (6 <= response.value && response.value < 8) {
                        $(".uvindexno").removeClass("bg-warning bg-danger bg-success bg-violet bg-yellow")
                        $(".uvindexno").addClass("bg-warning")
                    } else if (8 <= response.value && response.value < 11 ) {
                        $(".uvindexno").removeClass("bg-warning bg-danger bg-success bg-violet bg-yellow")
                        $(".uvindexno").addClass("bg-danger")
                    } else {
                        $(".uvindexno").removeClass("bg-warning bg-danger bg-success bg-violet bg-yellow")
                        $(".uvindexno").addClass("bg-violet") 
                    }
                });
            };

            function weatherforecastQuery(city,cities,todayDate) { 
                var APIKey = "a07df414557c7b11b6dc89a1457fd71b";
                var cityCoord = {};
                queryURL = "https://api.openweathermap.org/data/2.5/forecast?q=" + city + "&appid=" + APIKey;
                $.ajax({
                    url: queryURL,
                    method: "GET"
                    })
                    // We store all of the retrieved data inside of an object called "response"
                    .then(function(response) {

                        var weatherimagecode = [] 
                        var humidity = []
                        var temp = []
                        console.log(response)
                        for (var i = 0; i < 5; i++) {
                            temp[i]= 273.15 - (response.list[i].main.temp)
                            console.log(temp[i])
                            humidity[i]= 273.15 - (response.list[i].main.humidtiy)
                            console.log(humidity[i])
                            weatherimagecode[i] =response.list[i].weather[0].icon
                            console.log(weatherimagecode[i])
                            }
                            console.log(temp[i])
                            humidity[i]= 273.15 - (response.list[i].main.humidtiy)
                            console.log(humidity[i])
                            weatherimagecode[i] =response.list[i].weather[0].icon
                            console.log(weatherimagecode[i])
                        // Log the queryURL
                        console.log(queryURL);
                    
                        
                        // Log the resulting object
                        var imglink = "http://openweathermap.org/img/wn/" + weatherimagecode + "@2x.png" 


                });
            };

            
            // for (var i = 0; i < 5; i++) {
            //     var div1 = $("<div>");
            //     var div2 = $("<div>");
            //     var span1 =$("<span>");
            //     var p1 = $("<p>");
            //     var span2 =$("<span>");
            //     var p2 = $("<p>");
            //     var img = $("<img>");
            //     var h5 = $("<h5>");
            //     
            //     var imglink = "http://openweathermap.org/img/wn/" + imagecode[i] + "@2x.png"

            //     span2.addClass("forhumidityno");
            //     p2.addClass("humidity");
            //     span1.addClass("fortempno");
            //     p1.addClass("temp");
            //     h5.addClass("card-title");
            //     div2.addClass("card-body");
            //     img.addClass("card-img-top");
            //     div1.addclass("car bg-primary text-white");

            //     img.attr("src", imglink)
            //     img.attr("alt" , "weather image cap")
            //     div1.style("width: 9rem")

            //     span2.text(humidity[i]);
            //     span1.text(temp[i]);
            //     span1.text(todayDate.add(i , "day"));
                
            //     p2.append(span2)
            //     p1.append(span1)
            //     div2.append(h5).append(p1).append(p2)
            //     div1.append(img).append(div2)

            //     $(".forecast").append(div1)
                
            // }

            //Build Calender Function
            function get_calendar(day_no, days, todayOfmonth, dayOfmonth){
            var table = $('<table>');
            var tr = $('<tr>');
            //Row for the day letters
            for(var c=0; c<=6; c++){
                var td = $("<td>");
             
                td.text("SMTWTFS"[c]);
                tr.append(td);
                //console.log(tr)
            }
            table.append(tr);
            //console.log(table)
            
            //create 2nd row
            tr = $('<tr>');
            var c;
            for(c=0; c<=6; c++){
                if(c == day_no){
                    break;
                }
                var td = $('<td>');
                td.text("");
                tr.append(td);
            }
        
            var count = 1;
            for(c=day_no; c<=6; c++){
                var td = $('<td>');
                td.text(count);
                if (count==todayOfmonth){
                    td.addClass("text-primary")
                }
                if (count==dayOfmonth){
                        td.addClass("bg-warning rounded-circle")
                } 
                count++;
                tr.append(td);
            }
            table.append(tr);
            
            //rest of the date rows
            for(var r=3; r<=7; r++){
                tr = $('<tr>');
                for(var c=0; c<=6; c++){
                    if(count > days){
                        table.append(tr);
                        return table;
                    }
                    td = $('<td>');
                    td.text(count);
                    if (count==todayOfmonth){
                        td.addClass("text-primary")
                    }
                    if (count==dayOfmonth){
                        td.addClass("bg-warning rounded-circle")
                    }          
                    count++;
                    tr.append(td);
                }
                table.append(tr);
            }
            return table;
         }
          </script>
        </main>
    </div>
</div>
  <footer class="container-fluid mt-5 bg-RP text-dark">
    <div class="container">
        <div class="row mb-0 text-left py-5"> <!--Portfolio footer start-->
            <div class="col py-5 px-0">
            <h1 class="display-5">R-Innovative Protfolios</h1>

            <ul class="list-group list-group-flush bg-RP text-dark">
                <li class="list-group-item font-weight-bold bg-RP text-light">Raed</li>
                <li class="list-group-item bg-RP text-light">Raed Fun Protfolios</li>
            </ul>
            </div>
        </div>  <!--Portfolio footer end--> 
    </div>
  </footer>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <!-- <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/moment.min.js"></script>
  <!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>  
    
    
</body>
   
</html>